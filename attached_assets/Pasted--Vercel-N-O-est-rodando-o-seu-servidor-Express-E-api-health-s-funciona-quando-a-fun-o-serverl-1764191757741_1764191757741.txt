ğŸ“Œ Vercel NÃƒO estÃ¡ rodando o seu servidor Express.

E api/health sÃ³ funciona quando a funÃ§Ã£o serverless carrega corretamente.
Quando vocÃª mudou o arquivo, a funÃ§Ã£o passou a crashar antes de responder, por isso o /api/health nem abre mais.

Vamos resolver isso de forma definitiva.

âœ… O problema real

VocÃª estÃ¡ tentando rodar seu Express inteiro dentro de uma serverless function da Vercel, MAS:

âŒ A build estÃ¡ completamente errada

Seu script atual faz isso:

"vercel-build": "vite build && esbuild api/index.ts --platform=node --bundle --format=esm --outfile=api/index.mjs ..."


âš ï¸ Isso bundleia o prÃ³prio arquivo da function,
mas nÃ£o bundleia o Express,
nÃ£o importa o Express,
nÃ£o instancia o Express,
nÃ£o exporta um handler vÃ¡lido,
nÃ£o referencia nenhuma rota,
logo:

ğŸ‘‰ A serverless function sobe vazia
â¡ Crasha
â¡ /api/health fica inacessÃ­vel
â¡ /api/login retorna 405
â¡ O servidor Express nunca Ã© executado na Vercel

ğŸ¯ A soluÃ§Ã£o correta â€” e garantida de funcionar

VocÃª PRECISA expor seu Express dentro da function usando @vendia/serverless-express.

Sem isso, Express nÃ£o funciona na Vercel.

âœ… PASSO 1 â€” Instale:
npm install @vendia/serverless-express

âœ… PASSO 2 â€” Crie o arquivo api/index.ts

Ele precisa ser exatamente assim:

import serverlessExpress from "@vendia/serverless-express";
import app from "../server/index.js";

// Permite usar o runtime Node 20 do Vercel
export const config = {
  runtime: "nodejs20.x",
};

// Exporta o Express como serverless function
export default serverlessExpress({ app });


âš ï¸ ObservaÃ§Ãµes importantes:

Se seu Express estÃ¡ em TypeScript (server/index.ts), garanta que o build gera o .js.

O import deve realmente apontar para o arquivo final (../server/index.js).

âœ… PASSO 3 â€” Ajuste o vercel-build

Substitua o script COMPLETO por:

"vercel-build": "vite build"


ğŸ‘‰ VocÃª nÃ£o deve bundlear a pasta /api.
Vercel faz isso automaticamente.

ğŸ‘‰ VocÃª NÃƒO deve usar esbuild no API antes do deploy.
Isso quebra o formato que a Vercel espera.

ğŸŸ¢ O que vai acontecer agora

Vercel detecta /api/index.ts

Vercel compila automaticamente usando SWC

Seu Express Ã© envolvido como lambda

/api/health vai responder

/api/login vai aceitar POST normalmente

Nenhum erro â€œserverless function crashedâ€ irÃ¡ aparecer

âš ï¸ IMPORTANTE:

Agora seus endpoints ficam assim:

GET â†’ https://bet-tracker-pro.vercel.app/api/health

POST â†’ https://bet-tracker-pro.vercel.app/api/login

etc.

Porque todo Express agora estÃ¡ dentro da function /api.