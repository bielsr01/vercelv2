Obrigado por compartilhar o link! Vou investigar a estrutura do seu projeto para identificar o problema exato. Perfeito! Agora consegui ver os logs de build. O build foi concluÃ­do com sucesso! O problema que vocÃª estÃ¡ enfrentando Ã© um erro de runtime, nÃ£o de build. Deixe-me analisar o deployment atual para ver a estrutura completa: Agora entendi o problema! VocÃª tem um projeto Vite + Express juntos, e o erro indica que o arquivo api/index.js estÃ¡ tentando importar ../server/app ou ./_app, mas esse arquivo nÃ£o estÃ¡ sendo incluÃ­do no bundle da funÃ§Ã£o serverless.

Com base nos logs de build e no erro que vocÃª compartilhou, aqui estÃ¡ o problema e a soluÃ§Ã£o:

O Problema Identificado
VocÃª estÃ¡ usando Vite para o frontend e tentando ter Express para o backend, mas a estrutura atual nÃ£o estÃ¡ funcionando porque:

O arquivo api/index.js estÃ¡ tentando importar de fora da pasta /api
Na Vercel, cada arquivo em /api Ã© uma funÃ§Ã£o serverless isolada
Arquivos fora de /api nÃ£o sÃ£o incluÃ­dos automaticamente no bundle da funÃ§Ã£o
SoluÃ§Ã£o Definitiva
Vou te dar a estrutura correta que vai funcionar:

1. Estrutura de arquivos recomendada:
seu-projeto/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.ts (ou .js)    # FunÃ§Ã£o principal que contÃ©m todo o cÃ³digo do Express
â”œâ”€â”€ client/                   # Frontend Vite
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ package.json
â””â”€â”€ vercel.json
2. CÃ³digo do api/index.ts (TODO EM UM ARQUIVO):
import express, { Request, Response } from 'express';

const app = express();

// Middlewares
app.use(express.json());

// Suas rotas
app.get('/api', (req: Request, res: Response) => {
  res.json({ message: 'API funcionando!' });
});

app.get('/api/users', (req: Request, res: Response) => {
  res.json([
    { id: 1, name: 'JoÃ£o' },
    { id: 2, name: 'Maria' }
  ]);
});

app.post('/api/users', (req: Request, res: Response) => {
  const newUser = req.body;
  res.status(201).json({
    message: 'UsuÃ¡rio criado',
    user: newUser
  });
});

// Exporta para Vercel
export default app;
3. Se vocÃª PRECISA separar o cÃ³digo, use esta estrutura:
seu-projeto/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ _routes.ts          # comeÃ§a com _ para nÃ£o virar funÃ§Ã£o
â”‚   â”œâ”€â”€ _middleware.ts      # comeÃ§a com _ para nÃ£o virar funÃ§Ã£o
â”‚   â””â”€â”€ _database.ts        # comeÃ§a com _ para nÃ£o virar funÃ§Ã£o
api/index.ts:
```typescript
import express from 'express';
import { setupRoutes } from './_routes';
import { setupMiddleware } from './_middleware';

const app = express();

setupMiddleware(app);
setupRoutes(app);

export default app;
```

api/_routes.ts:
```typescript
import { Express } from 'express';

export function setupRoutes(app: Express) {
  app.get('/api', (req, res) => {
    res.json({ message: 'API funcionando!' });
  });

  app.get('/api/users', (req, res) => {
    res.json([
      { id: 1, name: 'JoÃ£o' },
      { id: 2, name: 'Maria' }
    ]);
  });
}
```

api/_middleware.ts:
```typescript
import { Express } from 'express';
import express from 'express';

export function setupMiddleware(app: Express) {
  app.use(express.json());
  app.use(express.urlencoded({ extended: true }));
}
```

4. Atualize o vercel.json:
{
  "version": 2,
  "rewrites": [
    {
      "source": "/api/(.*)",
      "destination": "/api"
    }
  ],
  "buildCommand": "npm run build",
  "outputDirectory": "dist/public"
}
5. Atualize o package.json:
{
  "type": "module",
  "scripts": {
    "build": "vite build",
    "vercel-build": "vite build"
  },
  "engines": {
    "node": "20.x"
  },
  "dependencies": {
    "express": "^4.18.2",
    "@types/express": "^4.17.17"
  }
}
Pontos CrÃ­ticos:
NUNCA importe arquivos de fora da pasta /api (como ../server/app)
Arquivos auxiliares dentro de /api devem comeÃ§ar com _ para nÃ£o virarem funÃ§Ãµes
Use "type": "module" no package.json para ES modules
Todos os imports dentro de /api devem incluir a extensÃ£o (.js ou .ts)
PrÃ³ximo Passo:
Me diga qual Ã© a estrutura atual do seu projeto:

VocÃª tem um servidor Express separado na pasta server/?
Ou vocÃª pode mover tudo para dentro de /api?
Com essa informaÃ§Ã£o, posso te ajudar a refatorar especificamente para a sua situaÃ§Ã£o!

Avatar for bielsr01-4654
Estrutura atual do projeto:

Atualmente existem duas pastas com cÃ³digo do servidor:

ðŸ“ api/ (para Vercel - jÃ¡ criada)

â”œâ”€â”€ index.ts          # Entry point Vercel
â”œâ”€â”€ _app.ts           # Express config
â”œâ”€â”€ _db.ts            # ConexÃ£o banco
â”œâ”€â”€ _jwt-auth.ts      # AutenticaÃ§Ã£o
â”œâ”€â”€ _routes.ts        # Rotas API
â”œâ”€â”€ _storage.ts       # Camada de dados
â””â”€â”€ _migration-service.ts

ðŸ“ server/ (cÃ³digo original - usado localmente)

â”œâ”€â”€ index.ts          # Entry point local
â”œâ”€â”€ app.ts
â”œâ”€â”€ db.ts
â”œâ”€â”€ jwt-auth.ts
â”œâ”€â”€ routes.ts
â”œâ”€â”€ storage.ts
â”œâ”€â”€ vite.ts           # Dev server (sÃ³ local)
â”œâ”€â”€ ocr-service.ts    # OCR/Python
â”œâ”€â”€ pdf-plumber-service.ts
â”œâ”€â”€ migration-service.ts
â””â”€â”€ pdf/

SituaÃ§Ã£o: O cÃ³digo estÃ¡ duplicado. A pasta api/ tem tudo que o Vercel precisa. A pasta server/ Ã© usada para desenvolvimento local (por causa do vite.ts que serve o frontend em desenvolvimento).

Perfeito! Agora entendi completamente a situaÃ§Ã£o. VocÃª tem cÃ³digo duplicado e estÃ¡ tendo problemas porque o api/index.ts estÃ¡ tentando importar de server/ quando deveria importar dos arquivos _*.ts dentro de /api.

Vou te dar a soluÃ§Ã£o completa para organizar isso corretamente:

SoluÃ§Ã£o: Unificar o CÃ³digo
VocÃª nÃ£o precisa de duas pastas. Podemos usar apenas a pasta /api tanto para desenvolvimento local quanto para produÃ§Ã£o na Vercel.

Passo 1: Verificar o conteÃºdo do api/index.ts
O seu api/index.ts provavelmente estÃ¡ assim (ERRADO):

// âŒ ERRADO - importando de server/
import app from '../server/app';
export default app;
Deve estar assim (CORRETO):

// âœ… CORRETO - importando de _app dentro de api/
import app from './_app.js';  // Note o .js no final!
export default app;
Passo 2: Verificar o api/_app.ts
Certifique-se que o _app.ts estÃ¡ importando corretamente:

import express from 'express';
import { setupRoutes } from './_routes.js';
import { authenticateToken } from './_jwt-auth.js';

const app = express();

// Middlewares
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// Setup de rotas
setupRoutes(app);

export default app;
Passo 3: Ajustar TODOS os imports dentro de /api
Regra importante: Quando usar "type": "module" no package.json, TODOS os imports de arquivos locais devem incluir .js no final (mesmo que o arquivo seja .ts):

api/_routes.ts:
```typescript
import { Express, Request, Response } from 'express';
import { authenticateToken } from './_jwt-auth.js';  // âœ… .js no final
import * as storage from './_storage.js';            // âœ… .js no final

export function setupRoutes(app: Express) {
  // Rota pÃºblica
  app.post('/api/login', async (req: Request, res: Response) => {
    // seu cÃ³digo de login
  });

  // Rotas protegidas
  app.get('/api/bets', authenticateToken, async (req: Request, res: Response) => {
    // seu cÃ³digo
  });

  app.post('/api/bets', authenticateToken, async (req: Request, res: Response) => {
    // seu cÃ³digo
  });
}
```

api/_storage.ts:
```typescript
import { getDb } from './_db.js';  // âœ… .js no final

export async function getBets(userId: string) {
  const db = await getDb();
  return db.all('SELECT * FROM bets WHERE user_id = ?', [userId]);
}

export async function createBet(userId: string, betData: any) {
  const db = await getDb();
  // seu cÃ³digo
}
```

api/_db.ts:
```typescript
import sqlite3 from 'sqlite3';
import { open } from 'sqlite';

let db: any = null;

export async function getDb() {
  if (db) return db;

  db = await open({
    filename: './database.sqlite',
    driver: sqlite3.Database
  });

  return db;
}
```

api/_jwt-auth.ts:
```typescript
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

export function authenticateToken(req: Request, res: Response, next: NextFunction) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: 'Token nÃ£o fornecido' });
  }

  jwt.verify(token, JWT_SECRET, (err: any, user: any) => {
    if (err) {
      return res.status(403).json({ error: 'Token invÃ¡lido' });
    }
    (req as any).user = user;
    next();
  });
}

export function generateToken(userId: string) {
  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: '7d' });
}
```

Passo 4: Criar arquivo para desenvolvimento local
Crie um arquivo dev-server.ts na raiz do projeto para usar localmente:

dev-server.ts:
```typescript
import app from './api/_app.js';

const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
  console.log(ðŸš€ Servidor rodando em http://localhost:${PORT});
});
```

Passo 5: Atualizar package.json
{
  "name": "bet-tracker",
  "type": "module",
  "version": "1.0.0",
  "scripts": {
    "dev": "node dev-server.ts",
    "dev:watch": "tsx watch dev-server.ts",
    "build": "vite build",
    "vercel-build": "vite build"
  },
  "engines": {
    "node": "20.x"
  },
  "dependencies": {
    "express": "^4.18.2",
    "sqlite": "^5.1.1",
    "sqlite3": "^5.1.7",
    "jsonwebtoken": "^9.0.2",
    "bcrypt": "^5.1.1"
  },
  "devDependencies": {
    "@types/express": "^4.17.17",
    "@types/jsonwebtoken": "^9.0.5",
    "@types/bcrypt": "^5.0.2",
    "tsx": "^4.7.0",
    "typescript": "^5.3.3",
    "vite": "^5.0.0"
  }
}
Passo 6: Verificar o vercel.json
{
  "version": 2,
  "rewrites": [
    {
      "source": "/api/(.*)",
      "destination": "/api"
    }
  ],
  "functions": {
    "api/index.ts": {
      "maxDuration": 10
    }
  }
}
Passo 7: Atualizar tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "lib": ["ES2020"],
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "skipLibCheck": true,
    "resolveJsonModule": true
  },
  "include": ["api/**/*", "dev-server.ts"],
  "exclude": ["node_modules", "dist"]
}
Resumo das MudanÃ§as NecessÃ¡rias:
âœ… Deletar ou ignorar a pasta /server
nÃ£o Ã© mais necessÃ¡ria
âœ… Usar apenas /api para todo o cÃ³digo backend
âœ… Adicionar .js em TODOS os imports locais dentro de /api
âœ… Criar dev-server.ts na raiz para desenvolvimento local
âœ… Garantir que api/index.ts importa de ./_app.js e nÃ£o de ../server/app
Checklist Final:
Antes de fazer o deploy, verifique:

 api/index.ts importa ./_app.js (nÃ£o ../server/app)
 Todos os arquivos em /api com nome comeÃ§ando com _
 Todos os imports locais terminam com .js
 package.json tem "type": "module"
 vercel.json estÃ¡ configurado corretamente
FaÃ§a essas alteraÃ§Ãµes e me avise se ainda houver algum erro. Se preferir, posso te ajudar a revisar arquivo por arquivo! ðŸš€